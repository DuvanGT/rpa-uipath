name: UiPath CI/CD Pipeline

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Permite ejecutarlo manualmente para pruebas

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout del c√≥digo
        uses: actions/checkout@v4 # Actualizado a v4

      - name: Pack Robot (Compilar)
        uses: UiPath/uipath-automation-package@v4 # Usamos la oficial para evitar errores de formato
        with:
          projectJsonPath: 'project.json'
          outputPath: 'output'
          version: '1.0.${{ github.run_number }}'

      - name: Guardar el artefacto compilado
        uses: actions/upload-artifact@v4
        with:
          name: RobotCompilado
          path: output/

  deploy:
    needs: build
    runs-on: windows-latest
    steps:
      - name: Descargar artefacto compilado
        uses: actions/download-artifact@v4
        with:
          name: RobotCompilado
          path: output/
      
      - name: Desplegar paquete al Orchestrator
        uses: UiPath/uipath-automation-deploy@v4
        with:
          orchestratorUrl: 'https://cloud.uipath.com'
          orchestratorTenant: 'DefaultTenant'
          accountName: ${{ secrets.UIPATH }}   # Verifica que en GitHub se llame UIPATH y sea 'quind'
          clientId: ${{ secrets.APP_ID }}      # Verifica que sea tu App ID
          clientSecret: ${{ secrets.APP_SECRET }} # Verifica que sea tu Secret
          packagePath: 'output' 
          folderName: 'Shared'